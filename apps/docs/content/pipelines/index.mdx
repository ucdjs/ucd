---
title: Pipelines
description: Data processing pipelines for UCD files
---

# Pipelines

The `@ucdjs/pipelines-*` packages provide a powerful, graph-based system for defining and running data processing pipelines on Unicode Character Database (UCD) files.

Pipelines are used to transform raw UCD files (like `UnicodeData.txt` or `Blocks.txt`) into structured data, artifacts, or TypeScript code.

## Architecture

The pipeline system is split into several packages:

- **`@ucdjs/pipelines-core`**: Core pipeline definitions, DAG (Directed Acyclic Graph) execution, events, and types.
- **`@ucdjs/pipelines-artifacts`**: Schema definitions and artifact management for pipeline outputs.
- **`@ucdjs/pipelines-graph`**: Utilities for building and visualizing pipeline execution graphs.
- **`@ucdjs/pipelines-loader`**: Utilities for loading pipeline definitions from files or remote sources.
- **`@ucdjs/pipelines-presets`**: Pre-built pipeline routes and transforms for common UCD files.
- **`@ucdjs/pipelines-ui`**: A web-based UI for visualizing and debugging pipeline executions.

## Core Concepts

A pipeline is composed of **Sources**, **Routes**, **Transforms**, and **Artifacts**.

### Sources

Sources define where the raw UCD files come from. They can be local files, HTTP URLs, or in-memory data.

```ts
import { definePipelineSource } from "@ucdjs/pipelines-core";

const mySource = definePipelineSource({
  id: "local-files",
  resolve: async (ctx) => {
    // Return a list of files to process
    return [
      { path: "UnicodeData.txt", content: "..." }
    ];
  }
});
```

### Routes

Routes define how specific files are processed. A route matches a file (e.g., by name or extension), parses its content, and resolves it into an output or artifact.

```ts
import { definePipelineRoute, byName } from "@ucdjs/pipelines-core";

const myRoute = definePipelineRoute({
  id: "unicode-data",
  filter: byName("UnicodeData.txt"),
  parser: async function* (ctx) {
    // Parse the file content into rows
    yield { code: "0041", name: "LATIN CAPITAL LETTER A" };
  },
  resolver: async (ctx, rows) => {
    // Transform rows into the final output
    const result = [];
    for await (const row of rows) {
      result.push(row);
    }
    return result;
  }
});
```

### Pipelines

A pipeline ties together sources and routes, defining the execution order using a Directed Acyclic Graph (DAG) based on route dependencies.

```ts
import { definePipeline } from "@ucdjs/pipelines-core";

const pipeline = definePipeline({
  id: "my-pipeline",
  name: "My Pipeline",
  versions: ["16.0.0"],
  inputs: [mySource],
  routes: [myRoute],
});
```

### Artifacts

Artifacts are the structured outputs of a pipeline route. They can be consumed by other routes in the same pipeline, allowing you to build complex data dependencies.

```ts
import { definePipelineArtifact } from "@ucdjs/pipelines-artifacts";

const myArtifact = definePipelineArtifact({
  id: "unicode-data-artifact",
  schema: mySchema,
});
```

## Running Pipelines

You can run pipelines programmatically using a pipeline executor, or via the [CLI](/architecture/cli#pipelines).

<Tabs items={["CLI", "Programmatic"]}>
  <Tab value="CLI">
    ```bash
    # List available pipelines in your project
    ucd pipelines list

    # Run a specific pipeline
    ucd pipelines run my-pipeline
    ```
  </Tab>
  <Tab value="Programmatic">
    ```ts
    import { createPipelineExecutor } from "@ucdjs/pipelines-core";

    const executor = createPipelineExecutor({ 
      pipelines: [pipeline] 
    });
    
    const result = await executor.run();
    ```
  </Tab>
</Tabs>

## Visualizing Pipelines

The `@ucdjs/pipelines-ui` package provides a web interface for visualizing pipeline execution, inspecting logs, and debugging route dependencies. You can start the UI using the CLI:

```bash
ucd pipelines run my-pipeline --ui
```

This will open a local web server where you can see the DAG, execution times, and emitted artifacts for each route.
