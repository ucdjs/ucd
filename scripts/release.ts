import { release } from "@ucdjs/release-scripts"

const workspaceRoot = new URL("../", import.meta.url);

release({
  repo: "ucdjs/ucd",
  workspaceRoot: workspaceRoot.pathname,
  packages: {
    include: [
      "env"
    ],
    excludePrivate: true,
    exclude: [
      "vscode-ucd"
    ]
  },
  safeguards: true,
  prompts: {
    packages: process.env.CI == null,
    versions: process.env.CI == null,
  },
  globalCommitMode: "dependencies",
  pullRequest: {
    body: `
      This PR was automatically generated by the UCD release scripts.

      The following packages have been prepared for release:

      <% if (it.packages.length > 0) { %>
        <% it.packages.forEach((pkg) => { %>
        - **<%= pkg.name %>**: <%= pkg.currentVersion %> â†’ <%= pkg.newVersion %> (<%= pkg.bumpType %>)
        <% }) %>
      <% } else { %>
        There are no packages to release.
      <% } %>

      Please review the changes and merge when ready.

      > [!NOTE]
      > When this PR is merged, the release process will be triggered automatically, publishing the new package versions to the registry.
    `
  },
  githubToken: process.env.UCDJS_RELEASE_TOKEN!,
  changelog: {
    enabled: true,
  }
})
